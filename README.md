## React native + Spring boot qr code login

### About

This project has been done with building custom authentication flows in mind as spring security's architecture offers the necesary building blocks to create these with ease.

### How it works

On the browser we make use of browser's [EventSource](https://developer.mozilla.org/es/docs/Web/API/EventSource) class in order to have unidirectional events beetwen the server and the browser.

On the server we keep reference to each [EventSource](https://developer.mozilla.org/es/docs/Web/API/EventSource) with the [SSEmitter](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/SseEmitter.html) class, so wen can send events to each particular source

On the mobile app we scan the qr-code which has missing entries that will be fullfied by the mobie app, once fullfiled we saved this code to the backend, once saved, we'll send the missing entries to the browser via event source events, so both the backend and the browser have the same qr-code, at this point the user can now login by sending the qr-code to the backend, if a code with the same entries is found it's considered to be a successful login.

There're some things to keep in mind:

- A new qr code is autogenerated every 10 minutes if no action has been taken
- A qr code without missing entries will be rejected by the mobile app
- The missing entries are unique ids, one randomly generated by the mobile app and the other refers to the user id, when saving the code on the browser both user ids must match to be considered a valid qr code
- Qr codes are redish hashes with life time of 10 minutes
- Reloading the page as expected will create a new event source therefore a new code

### Build

In order to run this project you'll need [Docker](https://www.docker.com/), [Java 17](https://docs.aws.amazon.com/corretto/latest/corretto-17-ug/downloads-list.html) and set up a react native environment, you follow this [guide](https://reactnative.dev/docs/environment-setup)

First you must package the backend with the following command:

```
$ ./qr-backend/gradlew bootJar
```

Once the backend is packaged, you'll start all the necesary services with following command: (this process can take a while)

```
$ docker-compose up -d
```

Now the mobile app, your computer and your smartphone must be connected to the same network, with that done, go to the network settings of your computer and look for the ipv4 ip address, now replace the ip on `./qr-web/src/utils/urls.ts` file with the one of your computer, connect your device to your computer and run:

```
node
$ npx react-native run android

yarn
$ yarn run android
```

Once all services are up and running you can find on the following ports
- 19006 for web
- 8080 for backend

As the last step, you must create an user by sending a request to `http://localhost:8080/api/v1/users` with the following schema:
```json
{
    "username": "your username",
    "password:": "your password",
    "email": "some@email.com"
}
```
